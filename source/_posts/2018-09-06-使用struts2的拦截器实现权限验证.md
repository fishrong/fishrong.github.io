---
layout: posts
title: 使用struts2的拦截器实现权限验证
categories: Java学习笔记
tags:
    - Java
    - struts2
---
应用场景：对于需要用户登录的网页进行身份验证，比如未登录不能浏览相关内容并跳转到登录页面。
## 一、在struts.xml配置文件中定义拦截器
```
<package name="default" extends="struts-default">
   <!-- 定义了一个名为authority的拦截器 -->
   <interceptors>
        <interceptor name="authority" class="cn.wangsr.AuthorityInterceptor"/>
   </interceptors>
</package>
```
## 二、在需要进行拦截的action中使用拦截器
```
<interceptor-ref name="defaultStack"></interceptor-ref>
<interceptor-ref name="authority"></interceptor-ref>
```
注：第一行为默认拦截器，如果不适用通过拦截器后将会丢失表单所提交数据。
<!--more-->
## 三、定义全局结果映射
如果在多个action中使用了拦截器，可以定义一个全局结果映射来作为拦截器处理后的结果页。
```
<global-results>
 			<result name="login">/WEB-INF/contents/index.jsp</result>
</global-results>
```

## 四、定义一个拦截器实现类
```
public class AuthorityInterceptor extends AbstractInterceptor{

	@Override
	public String intercept(ActionInvocation invocation) throws Exception {
		// TODO Auto-generated method stub
		ActionContext ctx = invocation.getInvocationContext();
		User user = (User)ctx.getSession().get("user");//在拦截器获取session中的值

		if(user!=null) {
			return invocation.invoke();//继续执行其它拦截器或action
		}
		ctx.put("timeout_tip", "请重新登录");
		return Action.LOGIN;//返回字符串所对应的result结果页
	}
}
```
