---
layout: posts
title: 网页编程常见问题及解决办法
categories: 网页编程常见问题
tags:
  - JS
  - CS
---
## 一、JS方面
### 屏蔽移动端弹出菜单
```
node.addEventListener('contextmenu', function(e){
  e.preventDefault();
});
```
### js实现移动端长按
移动端有`ontouchstart`、`ontouchmove`、`ontouchend`三个属性来对点击事件控制。
ontouchstart：点击时触发。  
ontouchmove：手指移动后触发。  
ontouchend：手指离开时触发。
**只对移动端生效**
长按实现思路：
  当手指点击时触发`ontouchstart`,开始计时，如果到了定时时间则判断为长按，执行相应长按函数，否则清除定时。
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>长按测试</title>
</head>
<body>
   <div id="hit" style="width:100%; height:100px; background-color:#CCC;" ontouchstart="gtouchstart()" ontouchmove="gtouchmove()" ontouchend="gtouchend()" onclick="">测试区域</div>    
<script>  
    //以下判断语句用来处理手机端出现两次点击问题
    if ((window.screen.availHeight)>710) {
            var a = document.getElementById("hit");
            a.setAttribute("onclick", "myclick()");
    }
    function myclick(){
        alert("电脑点击");
    };

    var timeOutEvent=0;//定时器   
    //开始按   
    function gtouchstart(){   
        timeOutEvent = setTimeout("longPress()",500);//这里设置定时器，定义长按500毫秒触发长按事件，时间可以自己改，个人感觉500毫秒非常合适   
        return false;   
    };   
    //手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件   
    function gtouchend(){   
        clearTimeout(timeOutEvent);//清除定时器   
        if(timeOutEvent!=0){   
            //这里写要执行的内容（尤如onclick事件）   
            alert("点击事件触发");

        }  
        else{
            alert("长按事件结束");
        }


        return false;   
    };   
    //如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按   
    function gtouchmove(){   
        clearTimeout(timeOutEvent);//清除定时器   
        timeOutEvent = 0;
        document.getElementById("sum").innerHTML = "end...";  

    };   
    var i = 0;  
    //真正长按后应该执行的内容   
    function longPress(){   
        timeOutEvent = 0;   
        //执行长按要执行的内容，如弹出菜单  
        alert("长按事件触发");

    };


</script>   
</body>
</html>
```
<!--more-->
### js实现网页录音
参考Github中两个例子
* [https://github.com/mattdiamond/Recorderjs](https://github.com/mattdiamond/Recorderjs)
* [https://github.com/xiangyuecn/Recorder](https://github.com/xiangyuecn/Recorder)

### 使用XMLHttpRequest上传blob数据
* 构建Form表单，如果是Django必须添加一个csrfmiddlewaretoken字段。
html需包含以下内容：
```
<form name="myform">
			{% csrf_token %}
</form>
```

JS内容：
```
var fd = new FormData();
//csrf校验
var csrf = myform.csrfmiddlewaretoken.value;
fd.append('csrfmiddlewaretoken',csrf);

fd.append("file", this.getBlob());
var xhr = new XMLHttpRequest();
//设置xhr请求的超时时间
xhr.timeout = 3000;
//设置响应返回的数据格式
xhr.responseType = "text";
//创建一个 post 请求，采用异步
xhr.open('POST', url, true);
//注册相关事件回调处理函数
xhr.onload = function(e) {
   if(this.status == 200||this.status == 304){
   alert(xhr.responseText);
  }
};
//发送数据
xhr.send(fd);
```
### 引用外部的js文件
```
<script src="script.js"></script>
```

### 作用域问题
　　1. 放在`<head>`部分
	head部分的代码会先于其余部分解析，所以如果要获取元素节点需要在js中加入`window.onload=function(){}`这个函数(加载完所有资源后执行)并把代码写在function中，这样才能获取到html定义的节点。  
　　2. 放在`<body>`部分  
	JavaScript代码在网页读取到该语句的时候就会执行。
### 全局变量与局部变量
　　1. 局部变量定义在function内部，格式为var+变量名  
　　2. 全局变量两种常用的声明方式：  
　　　１.定义在函数外部  
　　　２.函数内部的变量上升为全局变量：不用var直接给变量赋值
## 二、CSS方面  
### `div`元素居中问题
		* 1、使用`margin`居中  
		```
		margin-left:50%;
		margin-rigth:50%;
		```
		* 2、使用`inline-block`居中  
		将元素设为`inline-block`,然后将父类元素设为`text-align:center;`
### CSS设置鼠标悬浮样式  
```
th:hover{
	background-color:blue;
}
```
### 同一行解决图片文字不对齐
设置图片的`margin-bottom:-10px`可使文字上移

　　
