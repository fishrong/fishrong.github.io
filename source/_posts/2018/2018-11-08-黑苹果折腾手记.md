---
title: 黑苹果的折腾手记
date: 2018-11-05
categories: 操作系统
tags:
  - hackintosh
---
# 写在前面
情不知所起，一往而深。也不知道为什么突然就想折腾一下黑苹果，确实不负人们所说，黑苹果果然是比较难折腾的。
但如果能顺利装上黑苹果，那你对装系统肯定会有更深的认识。苹果系统使用起来确实感觉比Windows有很多人性化的设计，界面也更加漂亮，酷炫，还是值得折腾的。花了一周左右的时间成功装上了`10.14`，目前已经驱动集显、声卡、网卡、电量显示、亮度调节基本使用了，简单记录一下自己爬过的那些坑。
下面是系统界面。
![桌面](/images/apple_home.png)
需要注意的是每个人的电脑配置几乎都不一样，不可生搬硬套，方法仅供参考。
我的电脑配置如下：
电脑型号:ASUS FL5500L  
主板：X555LD  
处理器：i7 4510U  
显卡（核显）：hd4400  
**折腾黑苹果的几点建议**
1. 准备两个u盘，一个做苹果镜像，一个做成pe盘。因为可能会经常进不去系统，所以需要pe盘来做修复。
2. 善于使用搜索引擎，多尝试。每个人的硬件都不太一样，同一个问题别人的方法不一定适合你，但肯定是能找到一个解决办法的。
3. 耐心。
<!--more-->

# 整个流程
整个装黑苹果主要分成两部分工作：
* 装系统
* 装驱动、打补丁、配置clover文件

# 具体操作及注意事项
## 找合适的`efi`和`系统镜像`
`efi`就是操作系统的引导文件，苹果系统一般可以用`clover`来做开机引导。
这一步很简单也很难，因为资源网上都有，但是要找到适合你机型的比较困难。如果找不到合适的引导文件，直接就进不去装系统的界面。
这里推荐一个博客[黑果小兵的部落阁](https://blog.daliansky.net),这里有做好的系统，可以找找有没适合自己的系统，博客里也有相关教程。
[https://github.com/sqlsec/clover](https://github.com/sqlsec/clover)这里也整理了很多机型的efi。  
这里有一篇我对[原版镜像制作的全过程记录](https://www.jianshu.com/p/5a8d07821cc0)

## 开始装系统
### 使用`etcher`烧写系统
使用这款软件烧写系统比较方便。
下载[etcher](https://www.balena.io/etcher/)，插入u盘，选择镜像点击烧写即可。

### 使用Windows磁盘管理工具分出一块磁盘来装系统
使用`压缩卷`来新建一个大小大于80G的卷。这里 **不需要分配盘符，不需要格式化**。

### 开始装系统
* 关闭电脑重新开机，开机时狂`Esc`（以自己电脑进入bios的方式为准）。进入bios后选择自己做好系统的u盘。

* 不出意外会进入clover的引导界面类似下图
![clover](/images/clover1.jpg)
如果出现了这个界面但是找不到，苹果的系统盘，那可能是clover的版本不支持你下的镜像版本，需要找一个版本新一点的clover。

* 选择苹果的安装盘，回车  
一切正常的话会进入跑码阶段。这个阶段是将u盘的镜像读到电脑磁盘上。
跑完码之后clover界面会多出一个启动项，选择回车。  
如果跑码阶段挺住很久不动，那说明这份clover配置不适合你的机型，可以根据错误代码查找解决方法，也可以直接换一份efi。

* 如果一切顺利将会进入安装界面
1. 选择磁盘工具，对我们准备好的那个大于80g的磁盘抹盘，格式选择`mac扩展（日志式）`  
如果抹盘失败，很大可能是你的esp分区小于200m，可以用diskGenius对esp重新分配大小。
2. 回到安装界面，选择安装系统，等待安装完成即可。

## 驱动安装及clover文件配置
### 网卡
很多人都说大部分笔记本的网卡无解，苹果系统驱动不了。有两种选择：
1. 买一个可以驱动的无线给自己电脑装上。
2. 买一个USB无线网卡，插上装个驱动即可。

### 显卡
显卡正确驱动的话dock应该是半透明的，且在关于本机中显存不会是7m或者其它更小的值。
成功驱动显卡在于，选择正确的`ig-platform-id`,可以使用[clover configurator](https://mackie100projects.altervista.org/clover-configurator/)
根据自己显卡的型号选择合适的`ig-platform-id`,而且这里还跟`smbios`的机型有关，这里需要设置成和自己cpu参数相近的参数。  
**这两个参数还会影响到声卡是否能正常驱动**




### 声卡
两种方式  
* 使用万能声卡驱动`VoodooHDA.kext`放在clover/kexts目录下.重启，成功驱动界面应该如下
![](/images/voice.png)
我的放上这个驱动后直接不能开机，所以我选择了第二种方式。

* 使用`AppleALC.kext`。

clover 中的`acpi`选中如下两项：
![声卡配置](/images/voiceconfig.png)
`boot` 中的`custom flags`中添加`-lilubetaall`参数

###  电量显示
* clover 开机界面按f4 提取`dsdt`,将会存放到`clover/ACPI/origin`目录下。
* 使用`macisal`对提取的`DSDT.aml`改错。
常见错误：一连串`zero`直接删掉，或注释；同一代码块在return 语句后面如果还有语句直接删除。
* 改完错后开始电源打补丁。有两种选择，一、自己修改，将一些变量大于8的位数拆开。具体参考[http://bbs.appleosx.cn/forum.php?mod=viewthread&tid=128](http://bbs.appleosx.cn/forum.php?mod=viewthread&tid=128)
二、在[这里](https://github.com/RehabMan/Laptop-DSDT-Patch/tree/master/battery)找有没有适合自己电脑的补丁,直接打上。修改完后放到`clover/ACPI/patch`
* 打完补丁后把`ACPIBatteryManager.kext`放在clover的驱动目录下，重启。
如果没有显示，尝试拔下充电线，重启是否有正常显示。

### 亮度
将`SSDT-PNLF.aml`、`SSDT-ALS0.aml`两个文件放在`clover/ACPI/patch`目录下，另外一个就是
跟前面提的`ig-platform-id`设置也有关系，平台选对了就能正常显示。
设置成功后应该有亮度调节滑块如下图：
![亮度](/images/liangdu.png)

### 触摸板
* 使用`ApplePS2SmartTouchPad.kext`，正常驱动设置界面如下：
![触摸板](/images/touchpad.png)
可能会出现以下情况，触摸板可以正常用，比如双指滑动，但是可能不能点击，设置中还是没有找到触摸板。
我遇到这种情况在装上电源驱动，打上`dsdt`补丁后就又正常显示了。
* 修改`ApplePS2SmartTouchPad.kext`，定制自己的手势。
驱动触摸板后发现一些双指和三指的手势并没有效果，这时候就需要修改源文件了。
在`ApplePS2SmartTouchPad.kext/Resources`目录下有一个说明文档，给出了手势相对应的编号，我的版本是v 4.6.8,
需要注意的是，有些编号已经失效，如3对应的启动器已失效，`f13-f24` 应对应`21-32`，33应为右键。
![](/images/finger_gesture.png)
修改思路：修改`ApplePS2SmartTouchPad.kext/info.plist`中的`preferences`相应手势对应动作编号,如果需要绑定其它快捷键，可以先在电脑中设置好快捷键，再修改
`ApplePS2SmartTouchPad.kext/plugins`中的`ApplePS2Keyboard.kext`,将`f13-f24`定义为你设置的快捷键，再修改`ApplePS2SmartTouchPad.kext/info.plist`中手势对应`f13-f24`相应的编号。  
修改后手势功能如下：
**双指：**
1. 点击---------右键
2. 左边缘往右----切换到左空间
3. 有边缘往左----切换到右空间  
**三指：**
1. 点击-----启动器（系统设置启动器快捷键为ALT CMD L）
2. 向上-----桌面
3. 向下-----调度器
4. 向左-----后退
5. 向右-----前进
**四指：**
1. 点击-----全屏
2. 向上-----关闭应用
3. 向下-----最小化应用
发现问题：不知道什么原因，手势不能映射为锁屏快捷键。



## 其它问题
* 开机启动后8个苹果，登陆界面分裂花屏，按一下睡眠后唤醒又显示正常（对于1920*1080屏）。
解决方案有两种：
1、进入bios将`csm`设置为`enable`.
2、将clover的分辨率设置为`1280*1024`,这种方式开机会由大苹果变成小苹果

* `appstore`不能登录问题，如果你有appleid但是没有进过App Store那很可能不能登录。最快也是最方便的方法是，使用iPhone登录一下你的账号完善信息就OK。

## 最后
   感谢论坛、博客的各位大佬提供的资源及各种问题的解决方案。每个人的机型都不一样，它人的设置只能是当作参考，切勿生搬硬套。
   **配置文件可到github [下载](https://github.com/fishrong/ASUS-FL5500L-EFI)。**
   **原版镜像安装可参考简书文章[黑苹果折腾系列(一)原版镜像Mojave 10.14安装全过程记录](https://www.jianshu.com/p/5a8d07821cc0)
